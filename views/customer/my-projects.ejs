<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Projects - Propload</title>

    <!-- Tailwind & FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <style>
        :root {
            --propload-primary: #e9e2b3;
            --propload-secondary: #2f6c7b;
            --surface: #ffffff;
            --muted: #6b7280;
            --card-shadow: 0 8px 20px rgba(47, 76, 86, 0.06);
        }

        body {
            background-color: #f8fafc;
            font-family: 'Inter', sans-serif;
        }

        .project-card {
            background: var(--surface);
            border-radius: 1rem;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
        }

        .project-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        .status-badge {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.3rem 0.75rem;
            border-radius: 9999px;
        }

        .btn-primary {
            background: var(--propload-secondary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background 0.3s ease;
        }

        .btn-primary:hover {
            background: #244f5b;
        }

        .btn-outline {
            border: 1px solid var(--propload-secondary);
            color: var(--propload-secondary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
        }

        .info-icon {
            color: rgb(215, 64, 41);
            /* color: var(--propload-secondary); */
            cursor: pointer;
        }
    </style>
</head>

<body>
    <%- include('./sideNav') %>

      <div class="ml-0 md:ml-64 transition-all duration-300">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8 py-8">

    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
      <div class="flex items-center space-x-2">
        <a href="/customer/dashboard" class="text-[var(--propload-secondary)] hover:text-gray-800">
          <i class="fas fa-arrow-left text-xl"></i>
        </a>
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-500">My Projects</h1>
      </div>
      <div class="flex flex-wrap gap-3">
        <a href="/customer/update-statuses"
           class="btn-outline hover:bg-[var(--propload-secondary)] hover:text-white transition duration-300 flex items-center gap-2">
          <i class="fas fa-sync-alt"></i> Update Statuses
        </a>
        <a href="/customer/add-project" class="btn-primary flex items-center gap-2">
          <i class="fas fa-plus"></i> Add Project
        </a>
      </div>
    </div>

    <%- include('../partials/flash-messages') %>

    <% if (projects && projects.length > 0) { %>
    <div class="space-y-6">
      <% projects.forEach(project => { %>
      <div class="project-card p-4 sm:p-6 md:p-8 w-full">

        <!-- Title and Status -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4 md:gap-2">
          <div class="flex-1">
            <h2 class="uppercase text-xl sm:text-2xl font-semibold text-gray-900">
              <%= project.title || 'Untitled Project' %>
            </h2>
            <p class="text-sm text-gray-500 mt-1 flex items-center gap-1">
              <i class="fas fa-map-marker-alt text-[var(--propload-secondary)]"></i>
              <%= project.location?.city ? `${project.location.city}, ${project.location.state || ''}` : 'Location not set' %>
            </p>
          </div>

         <div class="mr-2 uppercase border border-blue-200 rounded p-1 text-center text-sm sm:text-base inline-block">
  PROP/<%= new Date(project.createdAt).getFullYear() %>/<%= project._id %>
</div>


          <div class="flex flex-wrap items-center gap-2">
            <span class="status-badge
              <%= project.status==='active'?'bg-blue-100 text-blue-700':'' %>
              <%= project.status==='completed'?'bg-green-100 text-green-700':'' %>
              <%= project.status==='pending'?'bg-yellow-100 text-yellow-700':'' %>
              <%= project.adminStatus==='defected'?'bg-red-100 text-red-700':'' %>">
              <%= project.adminStatus==='defected' ? 'DEFECTED' : (project.status ? project.status.toUpperCase() : 'DRAFT') %>
            </span>

            <% if (project.adminRemarks) { %>
            <i class="fas fa-info-circle info-icon" onclick="showRemarks('<%= project.adminRemarks %>')"></i>
            <% } %>
          </div>
        </div>

        <!-- Image -->
        <% if (project.featuredImage?.url) { %>
        <img src="<%= project.featuredImage.url %>" alt="Project image"
             class="w-full h-56 md:h-64 object-cover rounded-lg mb-4" onerror="this.style.display='none'">
        <% } %>

        <!-- Description -->
        <p class="text-gray-700 mb-4 leading-relaxed"><%= project.description || 'No description provided.' %></p>

        <!-- Meta Info -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 text-sm text-gray-600 mb-4">
          <div><i class="fas fa-tag mr-2 text-[var(--propload-secondary)]"></i><%= project.category || 'General' %></div>
          <div><i class="fas fa-calendar mr-2 text-green-600"></i>Starts: <%= project.timeline?.startDate ? moment(project.timeline.startDate).format('MMM D, YYYY') : 'Not set' %></div>
          <div><i class="fas fa-dollar-sign mr-2 text-yellow-600"></i>Estimated Cost: $<%= project.bidSettings?.startingBid || 0 %></div>
          <div><i class="fas fa-gavel mr-2 text-purple-600"></i><%= project.bids?.length || 0 %> Bids</div>
        </div>

        <!-- Buttons -->
        <div class="flex flex-wrap gap-2 mb-2">
          <a href="/customer/project/<%= project._id %>" class="btn-primary flex items-center gap-2 text-sm sm:text-base"><i class="fas fa-eye"></i> View Details</a>
          <% if (project.status==='drafted' || project.adminStatus==='defected') { %>
          <a href="/customer/edit-project/<%= project._id %>" class="bg-yellow-600 text-white px-3 py-1 rounded-md hover:bg-yellow-700 transition text-sm flex items-center gap-1"><i class="fas fa-edit"></i> Edit</a>
          <form action="/customer/delete-project/<%= project._id %>" method="POST" class="inline">
            <input type="hidden" name="_csrf" value="<%= csrfToken || '' %>">
            <button type="submit" onclick="return confirm('Are you sure?')" class="bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition text-sm flex items-center gap-1">
              <i class="fas fa-trash"></i> Delete
            </button>
          </form>
          <% } %>
        </div>

      </div>
      <% }) %>
    </div>
    <% } else { %>
    <div class="text-center py-16 bg-white rounded-lg shadow mx-4 sm:mx-0">
      <i class="fas fa-inbox text-gray-300 text-6xl mb-4"></i>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No projects yet</h3>
      <p class="text-gray-500 mb-6">Get started by creating your first project</p>
      <a href="/customer/add-project" class="btn-primary flex items-center justify-center mx-auto gap-2"><i class="fas fa-plus"></i> Create Project</a>
    </div>
    <% } %>

  </div>
</div>

<!-- Remarks Modal -->
<div id="remarksModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
  <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-md">
    <h2 class="text-xl font-semibold mb-4">Admin Remarks</h2>
    <p id="remarksText" class="text-gray-700 mb-4 break-words">Remark goes here</p>
    <button onclick="closeModal()" class="btn-primary w-full text-center">Close</button>
  </div>
</div>

<script>
  function showRemarks(remark) {
    const modal = document.getElementById('remarksModal');
    const remarksText = document.getElementById('remarksText');
    remarksText.textContent = remark || 'No remarks provided.';
    modal.classList.remove('hidden');
  }

  function closeModal() {
    document.getElementById('remarksModal').classList.add('hidden');
  }
</script>


</body>

</html>